# Render Blueprint - Server Guard Deployment
# https://render.com/docs/blueprint-spec
#
# UNIFIED STANDALONE DEPLOYMENT
# =============================
# This configuration runs the complete Server Guard application in a single container.
# Includes: React Frontend + All Backend Microservices
# - API Gateway (main entry point, handles external requests)
# - Ingest Service (telemetry ingestion)
# - Detection Engine (rule-based + ML anomaly detection)
# - Alert Manager (alert generation and routing)
# - Response Engine (automated incident response / SOAR)
# - Model Service (ML models for threat detection)
# - Frontend (React dashboard served via nginx)
#
# All services communicate via localhost within the container.
# Nginx serves the frontend and proxies API/WebSocket requests to the backend.

services:
  # ============================================
  # UNIFIED SERVER GUARD - Complete Application
  # ============================================
  - type: web
    name: server-guard
    runtime: docker
    plan: free
    dockerfilePath: ./Dockerfile.unified
    dockerContext: .
    numInstances: 1
    envVars:
      - key: API_GATEWAY_URL
        value: "http://127.0.0.1:3001"
      - key: INGEST_SERVICE_URL
        value: "http://127.0.0.1:8001"
      - key: DETECTION_ENGINE_URL
        value: "http://127.0.0.1:8002"
      - key: ALERT_MANAGER_URL
        value: "http://127.0.0.1:8003"
      - key: RESPONSE_ENGINE_URL
        value: "http://127.0.0.1:8004"
      - key: MODEL_SERVICE_URL
        value: "http://127.0.0.1:8006"
      - key: PYTHON_VERSION
        value: "3.11"
      - key: DEMO_MODE
        value: "true"
      # Note: PORT is automatically assigned by Render
    healthCheckPath: /health
